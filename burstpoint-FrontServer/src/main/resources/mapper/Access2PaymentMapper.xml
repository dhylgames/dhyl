<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yd.burst.dao.Access2PaymentMapper">
  <resultMap id="BaseResultMap" type="com.yd.burst.model.Access2Payment">
    <id column="id" jdbcType="INTEGER" property="id" />
    <id column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="operate_time" jdbcType="VARCHAR" property="operateTime" />
    <result column="mode" jdbcType="SMALLINT" property="mode" />
    <result column="msg" jdbcType="VARCHAR" property="msg" />
    <result column="amount" jdbcType="DOUBLE" property="amount" />
    <result column="status" jdbcType="SMALLINT" property="status" />
    <result column="type" jdbcType="SMALLINT" property="type" />
    <result column="player_id" jdbcType="INTEGER" property="playerId" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="update_time" jdbcType="VARCHAR" property="updateTime" />
    <result column="update_by" jdbcType="VARCHAR" property="updateBy" />
  </resultMap>

  <sql id="Base_Column_List">
      id, operate_time, mode, msg, amount, status, type, player_id, create_time, create_by,
      update_time, update_by
  </sql>

  <select id="selectByOrderId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
      select
      <include refid="Base_Column_List" />
      from bd_access2payment
      where order_id = #{orderId,jdbcType=INTEGER}
  </select>

  <insert id="insert" parameterType="com.yd.burst.model.Access2Payment">
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into bd_access2payment (order_id, operate_time, mode, msg,
      amount, status, type, player_id, create_time, create_by)
    values (#{orderId, jdbcType=VARCHAR}, #{operateTime,jdbcType=VARCHAR}, #{mode,jdbcType=SMALLINT}, #{msg,jdbcType=VARCHAR},
      #{amount,jdbcType=DOUBLE}, #{status,jdbcType=SMALLINT}, #{type,jdbcType=SMALLINT},
      #{playerId,jdbcType=INTEGER}, #{createTime,jdbcType=VARCHAR}, #{createBy,jdbcType=VARCHAR})
    ON DUPLICATE KEY UPDATE status = #{status,jdbcType=SMALLINT}, update_time = #{updateTime,jdbcType=VARCHAR}
  </insert>

  <select id="selectOrderId" resultType="java.lang.String">
    select order_id from bd_access2payment
        where status = 1
    <![CDATA[
        and create_time <= DATE_FORMAT(now(),'%Y-%m-%d %H:%i:%S')
        and create_time >= DATE_FORMAT(date_sub(now(), interval 1 hour),'%Y-%m-%d %H:%i:%S')
    ]]>
  </select>

</mapper>
